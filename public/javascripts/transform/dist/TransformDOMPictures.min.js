function App(){this.dom=document.getElementById("dom");var t=document.getElementById("svg-tool");this.tool=new DOMTransformTool(t),this.displayList=[new Picture(document.getElementById("fatcap"),50,50)],t.style.zIndex=this.displayList.length,this.setupTool(),this.bindHandlers(),this.dom.addEventListener(Mouse.START,this.down),this.render()}function Picture(t,o,n){this.image=t;var e=new Matrix(1,0,0,1,o,n),r=t.width||t.clientWidth,i=t.height||t.clientHeight;this.transform=new Transformable(r,i,e,this);var s="0 0",l=t.style;"undefined"!=typeof l.transformOrigin?l.transformOrigin=s:"undefined"!=typeof l.webkitTransformOrigin?l.webkitTransformOrigin=s:"undefined"!=typeof l.msTransformOrigin?l.msTransformOrigin=s:"undefined"!=typeof l.MozTransformOrigin?l.MozTransformOrigin=s:"undefined"!=typeof l.OTransformOrigin&&(l.OTransformOrigin=s)}App.create=function(){return App.instance=new App,App.instance},App.instance=null,App.prototype.bindHandlers=function(){this.up=this.up.bind(this),this.down=this.down.bind(this),this.move=this.move.bind(this),this.render=this.render.bind(this)},App.prototype.setupTool=function(){ControlSet.controlClass=DOMControl;var t=this.getCustomControls();this.tool.setControls(t)},App.prototype.getCustomControls=function(){var t=new DOMControl(Control.TRANSLATE);t.hitTestTarget=!0;var o=new DOMControl(Control.TARGET);return[new DOMControl(Control.ROTATE,0,0,0,0,30),new DOMControl(Control.ROTATE,0,1,0,0,30),new DOMControl(Control.ROTATE,1,0,0,0,30),new DOMControl(Control.ROTATE,1,1,0,0,30),o,t,new DOMControl(Control.BORDER),new DOMControl(Control.REGISTRATION,.5,.5,0,0,10),new DOMControl(Control.SKEW_Y,0,.5,0,0,10),new DOMControl(Control.SCALE_X,1,.5,0,0,10),new DOMControl(Control.SKEW_X,.5,0,0,0,10),new DOMControl(Control.SCALE_Y,.5,1,0,0,10),new DOMControl(Control.SCALE,0,0,0,0,10),new DOMControl(Control.SCALE,0,1,0,0,10),new DOMControl(Control.SCALE,1,0,0,0,10),new DOMControl(Control.SCALE,1,1,0,0,10),new DOMControl(Control.ROTATE_SCALE,1,0,15,-15,10),new DOMControl(Control.SCALE_UNIFORM,1,1,15,15,10),new DOMControl(Control.ROTATE,.5,0,0,-20)]},App.prototype.down=function(t){Mouse.get(t,this.dom);var o=this.tool.start(Mouse.x,Mouse.y);!o&&this.selectImage(Mouse.x,Mouse.y)&&(o=this.tool.start(Mouse.x,Mouse.y,this.findControlByType(Control.TRANSLATE))),o&&(this.dom.addEventListener(Mouse.MOVE,this.move),document.addEventListener(Mouse.END,this.up)),requestAnimationFrame(this.render),t.preventDefault()},App.prototype.move=function(t){Mouse.get(t,this.dom),this.applyDynamicControls(t),this.tool.move(Mouse.x,Mouse.y),requestAnimationFrame(this.render),t.preventDefault()},App.prototype.up=function(t){this.tool.end(),this.dom.removeEventListener(Mouse.MOVE,this.move),document.removeEventListener(Mouse.END,this.up),requestAnimationFrame(this.render),t.preventDefault()},App.prototype.applyDynamicControls=function(t){var o=this.getDynamicControl();o&&(t.ctrlKey?t.shiftKey?o.type=Control.ROTATE_SCALE:o.type=Control.ROTATE:t.shiftKey?o.type=Control.SCALE:o.type=Control.TRANSLATE)},App.prototype.getDynamicControl=function(){var t=0,o=this.tool.controls.length;for(t=0;o>t;t++)if(this.tool.controls[t].dynamicUV)return this.tool.controls[t];return null},App.prototype.findControlByType=function(t){var o=0,n=this.tool.controls.length;for(o=0;n>o;o++)if(this.tool.controls[o].type==t)return this.tool.controls[o];return null},App.prototype.selectImage=function(t,o){for(var n=null,e=null,r=this.displayList.length;r--;)if(n=this.displayList[r],e=n.transform,e.matrix.containsPoint(t,o,e.width,e.height))return this.tool.target!==e?(this.tool.setTarget(e),this.displayList.splice(r,1),this.displayList.push(n),!0):!1;return this.tool.setTarget(null),!1},App.prototype.render=function(){this.drawDisplayList(),this.tool.draw()},App.prototype.drawDisplayList=function(){var t=0,o=this.displayList.length;for(t=0;o>t;t++)this.displayList[t].image.style.zIndex=t,this.displayList[t].draw()},Picture.prototype.draw=function(){var t=this.transform.matrix.toString(),o=this.image.style;"undefined"!=typeof o.transform?o.transform=t:"undefined"!=typeof o.webkitTransform?o.webkitTransform=t:"undefined"!=typeof o.msTransform?o.msTransform=t:"undefined"!=typeof o.MozTransform?o.MozTransform=t:"undefined"!=typeof o.OTransform&&(o.OTransform=t)};